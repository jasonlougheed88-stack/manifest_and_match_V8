//
//  ProductionBuildConfiguration.xcconfig
//  Maximum Performance Production Build Configuration
//
//  Optimized build settings for App Store release ensuring maximum
//  Thompson Sampling performance advantage and minimal resource usage.
//

#include "Shared.xcconfig"

// MARK: - Build Configuration
CONFIGURATION_BUILD_DIR = $(BUILD_DIR)/$(CONFIGURATION)$(EFFECTIVE_PLATFORM_NAME)
BUILD_VARIANTS = normal

// MARK: - Swift Optimization (Maximum Performance)
SWIFT_OPTIMIZATION_LEVEL = -O
SWIFT_COMPILATION_MODE = wholemodule
SWIFT_WHOLE_MODULE_OPTIMIZATION = YES

// Enable all performance-enhancing Swift features
SWIFT_UPCOMING_FEATURE_CONCISE_MAGIC_FILE = YES
SWIFT_UPCOMING_FEATURE_FORWARD_TRAILING_CLOSURES = YES
SWIFT_UPCOMING_FEATURE_BARE_SLASH_REGEX_LITERALS = YES
SWIFT_UPCOMING_FEATURE_DISABLE_OUTWARD_ACTOR_INFERENCE = YES

// Swift 6.1 strict concurrency for thread safety
SWIFT_VERSION = 6.1
SWIFT_STRICT_CONCURRENCY = complete

// MARK: - Compiler Optimizations (Maximum Performance)
GCC_OPTIMIZATION_LEVEL = fast
LLVM_LTO = YES
LLVM_LTO_OBJECT_FILE = YES

// Dead code elimination
DEAD_CODE_STRIPPING = YES
DEPLOYMENT_POSTPROCESSING = YES

// Link-time optimization
OTHER_LDFLAGS = $(inherited) -Wl,-dead_strip -Wl,-x

// MARK: - Memory and Size Optimizations
STRIP_INSTALLED_PRODUCT = YES
STRIP_STYLE = all
SYMBOLS_HIDDEN_BY_DEFAULT = YES

// Reduce binary size
ENABLE_BITCODE = NO
GENERATE_PKGINFO_FILE = NO

// MARK: - App Store Specific Settings
CODE_SIGN_STYLE = Manual
CODE_SIGN_IDENTITY = iPhone Distribution
PROVISIONING_PROFILE_SPECIFIER = ManifestMatchV7_AppStore

// Bundle configuration
PRODUCT_BUNDLE_IDENTIFIER = com.manifest.match.v7
PRODUCT_NAME = ManifestAndMatchV7
MARKETING_VERSION = 7.0.0
CURRENT_PROJECT_VERSION = 1

// MARK: - Performance Monitoring Integration
OTHER_SWIFT_FLAGS = $(inherited) -DPRODUCTION_RELEASE -DAPP_STORE_CONNECT_MONITORING -DTHOMPSON_OPTIMIZATION_ENABLED

// App Store Connect integration
ENABLE_APP_SANDBOX = NO
ENABLE_HARDENED_RUNTIME = YES

// MARK: - Security and Privacy
CLANG_ENABLE_OBJC_ARC = YES
CLANG_ENABLE_OBJC_WEAK = YES
ENABLE_STRICT_OBJC_MSGSEND = YES

// Address sanitizer disabled for production
ENABLE_ADDRESS_SANITIZER = NO
ENABLE_THREAD_SANITIZER = NO
ENABLE_UNDEFINED_BEHAVIOR_SANITIZER = NO

// MARK: - Platform and Architecture
IPHONEOS_DEPLOYMENT_TARGET = 18.0
SUPPORTED_PLATFORMS = iphoneos
ARCHS = arm64

// Universal binary for all device classes
VALID_ARCHS = arm64

// MARK: - Entitlements and Capabilities
CODE_SIGN_ENTITLEMENTS = Config/ManifestAndMatchV7.entitlements

// MARK: - Build Performance
COMPILER_INDEX_STORE_ENABLE = NO
DEBUG_INFORMATION_FORMAT = dwarf-with-dsym

// MARK: - App Store Validation
VALIDATE_PRODUCT = YES
ENABLE_TESTABILITY = NO

// MARK: - Custom Performance Flags
THOMPSON_SAMPLING_OPTIMIZATION = 1
MEMORY_OPTIMIZATION_LEVEL = maximum
BATTERY_OPTIMIZATION_ENABLED = 1
PERFORMANCE_MONITORING_ENABLED = 1

// MARK: - Linker Optimizations
OTHER_LDFLAGS = $(inherited) -ObjC -lc++ -framework Foundation -framework UIKit -framework SwiftUI

// MARK: - Asset Optimization
COMPRESS_PNG_FILES = YES
REMOVE_CVS_FROM_RESOURCES = YES
REMOVE_GIT_FROM_RESOURCES = YES
REMOVE_HG_FROM_RESOURCES = YES
REMOVE_SVN_FROM_RESOURCES = YES

// MARK: - Performance Baseline Enforcement
// These custom flags are used by our build scripts to ensure performance benchmarks are met
ENFORCE_THOMPSON_PERFORMANCE_BASELINE = YES
THOMPSON_MAX_RESPONSE_TIME_MS = 10.0
MEMORY_USAGE_LIMIT_MB = 200
PERFORMANCE_RATIO_MINIMUM = 2

// MARK: - App Store Connect Analytics
APP_STORE_ANALYTICS_ENABLED = YES
CUSTOM_PERFORMANCE_EVENTS_ENABLED = YES
PERFORMANCE_VITALS_TRACKING = YES

// MARK: - Release Quality Gates
REQUIRE_PERFORMANCE_VALIDATION = YES
REQUIRE_MEMORY_VALIDATION = YES
REQUIRE_BATTERY_VALIDATION = YES